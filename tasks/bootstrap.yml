---
- name: docker - add user to docker group
  user:
    name: "{{ docker_user }}"
    groups: docker
    append: yes
  when: docker_user != ""
  become: true

# NOTE: use paramiko connection to force a re-login

- name: docker log into private registry and force re-authorization
  docker_login:
    registry: "{{ docker_registry }}"
    username: "{{ docker_registry_username }}"
    password: "{{ docker_registry_password }}"
    reauthorize: yes
  when:
    - docker_user != ""
    - docker_registry_username|default("") != ""
    - docker_registry_password|default("") != ""
  connection: paramiko
